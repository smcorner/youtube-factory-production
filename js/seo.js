const SEO = (() => { async function refresh() { const scripts = await DB.getAll('scripts'); const sel = document.getElementById('seo-script-select'); sel.innerHTML = '<option value="">Select Script</option>'; scripts.filter(s => s.status === 'approved' || s.status === 'produced').forEach(s => { const opt = document.createElement('option'); opt.value = s.id; opt.textContent = s.title || 'Untitled'; sel.appendChild(opt); }); } function loadScript() {} async function generate() { const scriptId = parseInt(document.getElementById('seo-script-select').value); if (!scriptId) return Factory.toast('Select a script', 'error'); const script = await DB.get('scripts', scriptId); if (!script) return Factory.toast('Script not found', 'error'); let niche = 'general'; if (script.channelId) { const ch = await Channels.getById(script.channelId); if (ch) niche = ch.niche; } const prompt = Prompts.SEO .replace('{{title}}', script.title || '') .replace('{{hook}}', script.hook || '') .replace('{{niche}}', niche); Factory.showLoading('Generating SEO pack...'); try { const raw = await Factory.callLLM(prompt); const data = Factory.parseJSON(raw); let html = ''; if (data.title_variants) { html += '<h3>üìù Title Variants</h3><ol>'; data.title_variants.forEach(t => { html += `<li>${Factory.esc(t)}</li>`; }); html += '</ol>'; } if (data.description) { html += `<h3>üìÑ Description</h3><pre style="white-space:pre-wrap">${Factory.esc(data.description)}</pre>`; } if (data.tags) { html += '<h3>üè∑Ô∏è Tags</h3><div class="meta">'; data.tags.forEach(t => { html += `<span>${Factory.esc(t)}</span>`; }); html += '</div>'; } if (data.hashtags) { html += '<h3>#Ô∏è‚É£ Hashtags</h3><p>' + data.hashtags.map(h => Factory.esc(h)).join(' ') + '</p>'; } if (data.chapters) { html += '<h3>üìë Chapters</h3><ul>'; data.chapters.forEach(c => { html += `<li>${Factory.esc(c.time || '')} - ${Factory.esc(c.label || '')}</li>`; }); html += '</ul>'; } if (data.pinned_comment) { html += `<h3>üìå Pinned Comment</h3><pre style="white-space:pre-wrap">${Factory.esc(data.pinned_comment)}</pre>`; } const copyBtn = `<button onclick="navigator.clipboard.writeText(JSON.stringify(${Factory.esc(JSON.stringify(data))}, null, 2)).then(()=>Factory.toast('Copied','success'))">üìã Copy All JSON</button>`; document.getElementById('seo-output').innerHTML = copyBtn + html; Factory.hideLoading(); Factory.toast('SEO pack generated', 'success'); } catch (e) { Factory.hideLoading(); Factory.toast('SEO generation failed: ' + e.message, 'error'); } } return { refresh, loadScript, generate }; })();